(function(a){a.fn.githubVoice=function(b,d,c){c=a.extend(true,{},a.fn.githubVoice.defaults,c||{});c.path=b+"/"+d;this.setupExtras(c.setup||a.fn.githubVoice.base,c);this.each(function(){a(this).trigger("github-voice-initialize")});return this};a.fn.githubVoice.base={initialize:[function(){this.bind("github-voice-initialize",function(){a(this).trigger("github-voice-bindEventListeners")})}],bindEventListeners:[function(b){this.bind("github-voice-bindEventListeners",function(){var d=a(this);d.click(function(){var c=
d.data("cache");b.overlay&&d.trigger("github-voice-createOverlay");d.trigger("github-voice-createElement").trigger("github-voice-updatePosition");c?d.trigger("github-voice-update",[c]):a.getJSON("http://github.com/api/v2/json/issues/list/"+(b.path+"/open")+"?callback=?",function(e){d.trigger("github-voice-update",[e]);d.data("cache",e)});return false})})}],createElement:[function(b){this.bind("github-voice-createElement",function(){a("body").append(b.html);a("#github-voice").find("p.description").html(b.text.description).end().find("li.loading").html(b.text.loading).end().find("p.call-to-action a").html(b.text.callToAction).attr("href",
"http://github.com/"+b.path+"/issues");a("#github-voice-wrapper .close").click(function(){a("#github-voice-overlay, #github-voice-wrapper").remove()})})}],createOverlay:[function(){this.bind("github-voice-createOverlay",function(){a("body").append('<div id="github-voice-overlay"></div>').find("#github-voice-overlay").css({width:a(window).width(),height:a(document).height(),opacity:0.75}).click(function(){a("#github-voice-overlay, #github-voice-wrapper").remove()})})}],update:[function(b){this.bind("github-voice-update",
function(d,c){var e=b.sort,i=a("#github-voice ol").empty(),j=0,g;c.issues.sort(a.isFunction(e)?e:function(h,f){return h[e]<f[e]?1:h[e]>f[e]?-1:0});a.each(c.issues,function(h,f){if(b.filter){g=true;a.each(b.filter,function(k,l){if(!f[k].match(l))return g=false});if(!g)return}i.append('<li><p class="votes"><em>'+f.votes+'</em> votes</p><h3><a href="http://github.com/'+b.path+"/issues#issue/"+f.number+'">'+f.title+"</a></h3></li>");if(++j==b.limit)return false});a("#github-voice p.call-to-action a").append("<span> ("+
c.issues.length+" ideas)</span>");a(this).trigger("github-voice-updatePosition")})}],updatePosition:[function(){this.bind("github-voice-updatePosition",function(){var b=a("#github-voice-wrapper");b.css("margin-top",-1*(b.height()/2))})}]};a.fn.githubVoice.defaults={sort:"votes",limit:5,overlay:true,filter:null,text:{loading:"Loading...",description:"We've setup a feedback forum so you can tell us what's on your mind. Please go there and be heard!",callToAction:"&raquo; Go to our Feedback Forum"},
html:'    <div id="github-voice-wrapper">       <div class="close" />       <h1>Feedback</h1>       <div id="github-voice">         <p class="description"></p>         <ol>           <li class="loading"></li>         </ol>         <p class="call-to-action"><a href="#"></a></p>       </div>     </div>'};jQuery.fn.setupExtras=function(b,d){for(property in b){var c=this;if(b[property]instanceof Array)for(var e=0;e<b[property].length;e++)b[property][e].call(c,d);else b[property].call(c,d)}}})(jQuery);
